# 3.1 高可用+双层负载均衡

暂时先介绍网关到后端服务器负载均衡

新渡-国密安全WEB网关负载均衡支持情况如下：

|   功能   | 客户端到网关 | 网关到后端服务器 |
| :------: | :----------: | :--------------: |
| 负载均衡 |     支持     |       支持       |

### 3.1.1 网关到后端服务器

新渡-国密安全WEB网关到后端服务器内置了负载均衡算法，也可针对需求对负载均衡算法进行扩展。

内置的负载均衡策略如下：

> * 字母顺序第一个(FirstAlphabetical)：选择按字母顺序排列的第一个可用目的地，不考虑负载。
> * 随机(Random)：随机选择一个目的地。
> * 两次随机选择(PowerOfTwoChoices)：随机选择两个目的地，然后选择处理请求最少的一个。
> * 轮询(RoundRobin)：按顺序循环选择目的地。
> * 最少请求(LeastRequests)：选择处理请求最少的目的地。


* 演示项目：配置网关到后端服务器的负载均衡

* 预期结果：使用客户端多次访问"新渡-国密安全WEB网关"，我们配置的后端服务器A和后端服务器B会按照顺序与客户端建立通信，例如：第一次访问会与后端服务器A建立通信，第二次访问则与后端服务器B建立通信，第三次访问又会与服务器A建立通信，以此类推。

* 演示过程：

  1. 我们以端口为5000的服务器作为我们的后端服务器A，以端口为5001的服务器作为我们的后端服务器B，然后将这两个服务器地址配置到网关中，并配置负载均衡策略为：轮询(RoundRobin)。

  2. 接着我们使用"谷歌浏览器"访问"新渡-国密安全WEB网关"。

  3. 第一次访问，由图可以看到，显示的是"我是后端端口为5001的服务器"（后端服务器A）。

     ![image-20220614162819693](../image/yarpfuzai5000.png ':size=75%')

  4. 接着我们进行第二次访问，由图可见这次显示的是"我是后端端口为5001的服务器"（后端服务器B）。

     ![image-20220614162913667](../image/yarpfuzai5001.png ':size=75%')

  5. 结合两次的访问结果可以看出，我们配置的负载均衡已生效。

至此，"新渡-国密安全WEB网关"负载均衡功能演示完毕，结果与预期结果相同。