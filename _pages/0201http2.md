# 2.1配置HTTP2

案例演示：配置HTTP2

演示配置组合如下：

| 客户端到网关使用协议 | 网关到后端服务器使用协议 |
| :------------------: | :----------------------: |
|       HTTP1.1        |         HTTP1.1          |
|       HTTP1.1        |          HTTP2           |
|        HTTP2         |         HTTP1.1          |
|        HTTP2         |          HTTP2           |

<p style="color:red;font-weight:bold">
       注:演示以国密通信为例，国际通信不再演示，效果与国密算法相同
</p>

## 2.1.1 客户端到网关HTTP1.1，网关到后端服务器HTTP1.1

> 客户端到网关HTTP1.1，网关到后端服务器HTTP1.1

1. 我们首先将网关使用的协议配置为只支持HTTP1.1

2. 在后端服务器使用tcpdump抓取网关到后端服务器的数据。

3. 接着我们使用奇安信浏览器访问[新渡-国密安全WEB网关](https://home.hccie.com:21443/),由图可看出成功建立了国密通信

   ![image-20220601151217143](../image/image-20220601151217143.png ':size=75%')

4. 因为我们将网关设置成了只支持http1.1协议，所以成功建立国密通信，就表示网关支持HTTP1.1的配置。


5. 接着我们将后端服务器抓取的数据包保存出来，同样使用wireshark进行分析，由图看出，网关到后端服务器使用的协议为HTTP1.1

   ![image-20220601142348802](../image/wg-hdhttp1.png ':size=75%')

## 2.1.2 客户端到网关HTTP1.1，网关到后端服务器HTTP2

> 客户端到网关使用HTTP1.1，网关到后端服务器使用HTTP2

5. 我们接着上面的"2.1.1",这次客户端到网关的使用协议我们不动,仍为HTTP1.1，将网关到后端服务器的协议更改为HTTP2。

6. 再次使用奇安信浏览器访问 [新渡-国密安全WEB网关](http://home.hccie.com:21443/)，并使用tcpdump对后端数据进行抓取，结果如下：

   由图可看出，网关到后端服务器这次使用的协议为HTTP2

   ![image-20220601143936864](../image/WG-HDht2.png ':size=75%')

## 2.1.3 客户端到网关HTTP2，网关到后端服务器HTTP1.1

> 客户端到网关HTTP2，网关到后端服务器HTTP1.1

1. 我们首先将网关使用协议配置为只支持HTTP2

2. 然后打开wireshark抓取客户端到网关的数据，在后端服务器使用tcpdump抓取网关到后端服务器的数据。

3. 接着我们使用奇安信浏览器访问[新渡-国密安全WEB网关](https://home.hccie.com:21443/),由图可看出成功建立了国密通信

   ![image-20220601151217143](../image/image-20220601151217143.png ':size=75%')

4. 然后我们先分析wireshark抓取的客户端到网关的数据包，由图可以看出，使用了http2

   ![image-20220601182645817](../image/image-20220601182645817.png ':size=75%')

5. 接着我们将后端服务器抓取的数据包保存出来，同样使用wireshark进行分析，由图看出，网关到后端服务器使用的协议为HTTP1.1

   ![image-20220601142348802](../image/wg-hdhttp1.png ':size=75%')

   

## 2.1.4 客户端到网关HTTP2，网关到后端服务器HTTP2

> 客户端到网关HTTP2，网关到后端服务器HTTP2

5. 我们接着上面的"2.1.3",这次客户端到网关的使用协议我们不动,仍为HTTP2，将网关到后端服务器的协议更改为HTTP2。

6. 再次使用奇安信浏览器访问 [新渡-国密安全WEB网关](http://home.hccie.com:21443/)，并使用tcpdump对后端数据进行抓取，结果如下：

   由图可看出，网关到后端服务器这次使用的协议为HTTP2

   ![image-20220601143936864](../image/WG-HDht2.png ':size=75%')
