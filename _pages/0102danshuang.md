# 1.2 国密TLS的单向认证和双向认证

### 产品指标

新渡-国密安全WEB网关与WEB应用建立国密通信时既支持单向认证，又支持双向认证。

### 指标演示

##### 国密单向认证

* 演示项目：新渡-国密安全WEB网关与WEB应用建立国密通信使用单向认证

* 预期结果：使用支持国密协议的WEB应用访问“新渡-国密安全WEB网关”成功建立国密通信，并且通过商用密码检测工具箱对数据进行分析，分析发现通信过程为标准的TLS单向认证过程

* 演示过程：

  1. 首先我们打开[商用密码检测工具箱](https://www.ailawuyou.com/micetoolbox/)，进入流量分析，选择网络接口，过滤条件为"**host 网关地址**",然后我们勾选"SSL|VPN交互过程分析"，然后点击开始按钮，抓取WEB应用访问“新渡-国密安全WEB网关”的数据

     ![image-20220602164019887](../image/MiCeZhua.png ':size=75%')

  2. 然后我们使用"奇安信安全浏览器"访问“新渡-国密安全WEB网关”，由图可看出成功建立国密连接

     ![gm_cbc](../image/gm_cbc.png ':size=75%')

  3. 查看抓取的数据包，由图可以看到此次通讯为标准的单向认证过程

     ![image-20220602165003349](../image/danxiang.png ':size=75%')

##### 国密双向认证

* 演示项目：新渡-国密安全WEB网关与WEB应用建立国密通信使用双向认证

* 预期结果：使用支持国密协议的WEB应用访问“新渡-国密安全WEB网关”成功建立国密通信，并且通过商用密码检测工具箱对数据进行分析，分析发现通信过程为标准的TLS双向认证过程

* 演示过程：

  1. 首先开启"新渡-国密安全WEB网关"的请求客户端证书功能

  2. 然后准备用于存放国密证书的硬件key，并将国密证书导入

  3. 我们打开[商用密码检测工具箱](https://www.ailawuyou.com/micetoolbox/)，进入流量分析，选择网络接口，过滤条件为"**host 网关地址**",然后我们勾选"SSL|VPN交互过程分析"，然后点击开始按钮，抓取WEB应用访问“新渡-国密安全WEB网关”的数据

     ![image-20220602164019887](../image/MiCeZhua.png ':size=75%')

  4. 连接硬件key，然后我们使用"奇安信安全浏览器"访问“新渡-国密安全WEB网关”，由图可以看到弹出了选择证书的页面，选择相应的国密证书，并输入硬件key的密码后点击确定

     ![shuangxiang](../image/shuangxiang.png ':size=75%')

  5. 成功访问

     ![gm_cbc](../image/gm_cbc.png ':size=75%')

  6. 查看[商用密码检测工具箱](https://www.ailawuyou.com/micetoolbox/)抓取的数据包，由图可以看到此次通讯为标准的TLS双向认证过程
  
     ![image-20220606171209502](../image/shuang_.png ':size=75%')
  
  至此，"新渡-国密安全WEB网关"的国密单向认证和双向认证演示完毕，结果与预期结果相同。

